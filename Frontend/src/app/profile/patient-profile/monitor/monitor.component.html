<div class="ecg-container p-4 max-w-7xl mx-auto flex flex-col gap-6">
  <!-- Header Section -->
  <div class="">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">ECG Monitor</h1>
    <p class="text-gray-600">
      Real-time electrocardiogram monitoring and analysis
    </p>
  </div>

  <!-- Status Section -->
  <div class="status-section mb-6"></div>

  <!-- Chart Section -->
  <!-- ecg -->
  <div
    class="bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden"
  >
    <div class="bg-white rounded-t-lg p-4 border border-gray-200">
      <div class="flex items-center justify-between">
        <div class="flex flex-col gap-2">
          <div class="flex gap-3">
            <h2
              class="text-lg font-semibold text-gray-800 font-title flex items-center gap-2"
            >
              <i class="pi pi-chart-line text-blue-600"></i>
              LEAD 1
            </h2>
            <div class="flex items-center gap-4">
              <div class="flex items-center gap-2">
                <div
                  class="w-3 h-3 rounded-full"
                  [class.bg-green-500]="ecgConnected()"
                  [class.bg-red-500]="!ecgConnected()"
                ></div>
                <span class="text-sm font-medium text-gray-700">
                  {{ ecgConnected() ? "Connected" : "Disconnected" }}
                </span>
              </div>
            </div>
          </div>
          <div class="font-main text-black">
            LIVE READING:
            <span class="text-red-400">{{ dataPointsReceivedECG() }}</span>
          </div>
        </div>

        <div class="flex gap-3 items-center">
          @if(lead1) {
          <p-button
            [label]="lead1.isPlaying() ? 'Pause' : 'Resume'"
            [icon]="lead1.isPlaying() ? 'pi pi-pause' : 'pi pi-play'"
            (onClick)="lead1.togglePlayPause()"
            [severity]="lead1.isPlaying() ? 'warn' : 'success'"
            size="large"
            class="min-w-[120px]"
          ></p-button>

          }
        </div>
      </div>
    </div>

    <div class="chart-container">
      <svg #ecgSVG class="w-full bg-gray-900"></svg>
    </div>
  </div>

  <!-- bp -->
  <div
    class="bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden"
  >
    <div class="bg-white rounded-t-lg p-4 border border-gray-200">
      <div class="flex items-center justify-between">
        <div class="flex flex-col gap-2">
          <div class="flex gap-3">
            <h2
              class="text-lg font-semibold text-gray-800 font-title flex items-center gap-2"
            >
              <i class="pi pi-chart-line text-blue-600"></i>
              Blood Pressure
            </h2>
            <div class="flex items-center gap-4">
              <div class="flex items-center gap-2">
                <div
                  class="w-3 h-3 rounded-full"
                  [class.bg-green-500]="bpConnected()"
                  [class.bg-red-500]="!bpConnected()"
                ></div>
                <span class="text-sm font-medium text-gray-700">
                  {{ bpConnected() ? "Connected" : "Disconnected" }}
                </span>
              </div>
            </div>
          </div>
          <div class="font-main text-black">
            LIVE READING:
            <span class="text-red-400">{{ dataPointsReceivedBP() }}</span>
          </div>
        </div>

        <div class="flex gap-3 items-center">
          @if(bpChart) {
          <p-button
            [label]="bpChart.isPlaying() ? 'Pause' : 'Resume'"
            [icon]="bpChart.isPlaying() ? 'pi pi-pause' : 'pi pi-play'"
            (onClick)="bpChart.togglePlayPause()"
            [severity]="bpChart.isPlaying() ? 'warn' : 'success'"
            size="large"
            class="min-w-[120px]"
          ></p-button>
          }
        </div>
      </div>
    </div>

    <div class="chart-container">
      <svg #bpSVG class="w-full h-full"></svg>
    </div>
  </div>

  <!-- Markers Section -->
  @if(lead1.hasMarkers()) {
  <div class="markers-section">
    <div class="mb-4">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">Recorded Readings</h2>
      <p class="text-gray-600">
        {{ lead1.getMarkerCount() }} reading(s) recorded
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      @for (marker of lead1.getMarkers(); track marker.id) {
      <p-card class="h-full">
        <ng-template #title>
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-800">
              Reading:
              <span class="text-blue-600 font-bold">{{ marker.value }}</span>
            </h3>
            <p-badge
              [value]="'#' + marker.id"
              severity="info"
              class="text-xs"
            ></p-badge>
          </div>
        </ng-template>

        <ng-template #subtitle>
          <div class="flex items-center gap-2 text-sm text-gray-500 mb-3">
            <i class="pi pi-clock"></i>
            <span>{{ lead1.formatTime(marker.time) }}</span>
            <i class="pi pi-map-marker ml-2"></i>
            <span>({{ marker.x }}, {{ marker.y }})</span>
          </div>
        </ng-template>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            <i class="pi pi-comment mr-1"></i>
            Remark:
          </label>
          <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
            <p class="text-gray-700 text-sm leading-relaxed">
              @if (marker.remark.length) {
              {{ marker.remark }}
              } @else {
              <span class="text-gray-400 italic">No remark added</span>
              }
            </p>
          </div>
        </div>

        <ng-template #footer>
          <div class="flex justify-end gap-2">
            <p-button
              icon="pi pi-pencil"
              size="small"
              (onClick)="lead1.editMarker(marker)"
              severity="secondary"
              [outlined]="true"
              pTooltip="Edit marker"
              tooltipPosition="top"
            ></p-button>
            <p-button
              icon="pi pi-times"
              size="small"
              (onClick)="lead1.removeMarker(marker.id)"
              severity="danger"
              [outlined]="true"
              pTooltip="Delete marker"
              tooltipPosition="top"
            ></p-button>
          </div>
        </ng-template>
      </p-card>
      }
    </div>

    <div class="mt-4 flex justify-center">
      <p-button
        label="Clear All Markers"
        icon="pi pi-trash"
        (onClick)="lead1.clearMarkers()"
        severity="danger"
        [outlined]="true"
        size="large"
      ></p-button>
    </div>
  </div>
  } @else {
  <div class="empty-state">
    <div
      class="bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-8 text-center"
    >
      <div class="flex flex-col items-center gap-3">
        <i class="pi pi-chart-line text-4xl text-gray-400"></i>
        <h3 class="text-lg font-semibold text-gray-600">
          No Readings Recorded
        </h3>
        <p class="text-gray-500 max-w-md">
          Click on the ECG waveform to add markers and record important readings
          for analysis.
        </p>
      </div>
    </div>
  </div>
  }
</div>

@if(lead1){
<p-dialog
  [(visible)]="lead1.showMarkerDialog"
  header="Add/Edit Marker"
  [closable]="true"
  [modal]="true"
  [breakpoints]="{ '960px': '75vw', '640px': '90vw' }"
  [style]="{ width: '450px' }"
  [contentStyle]="{ padding: '0' }"
>
  <div class="p-6">
    <div class="space-y-4">
      <!-- Time Display -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex items-center gap-2">
          <i class="pi pi-clock text-blue-600"></i>
          <span class="font-medium text-blue-800">
            Time:
            {{ lead1.formatTime(lead1.selectedMarker?.time || 0) }}
          </span>
        </div>
        <div class="flex items-center gap-2 mt-2 text-sm text-blue-600">
          <i class="pi pi-map-marker"></i>
          <span
            >Position: ({{ lead1.selectedMarker?.x }},
            {{ lead1.selectedMarker?.y }})</span
          >
        </div>
      </div>

      <!-- Remark Input -->
      <div class="space-y-2">
        <label for="remark" class="block text-sm font-medium text-gray-700">
          <i class="pi pi-comment mr-1"></i>
          Remark:
        </label>
        <textarea
          id="remark"
          pTextArea
          [(ngModel)]="lead1.markerRemark"
          rows="4"
          placeholder="Enter your detailed remark or observation here..."
          class="w-full resize-none"
        ></textarea>
        <p class="text-xs text-gray-500">
          Add any relevant medical observations or notes for this reading.
        </p>
      </div>
    </div>
  </div>

  <ng-template #footer>
    <div class="flex justify-end gap-2 p-4 bg-gray-50 border-t border-gray-200">
      <p-button
        label="Cancel"
        icon="pi pi-times"
        (onClick)="lead1.cancelMarkerEdit()"
        severity="secondary"
        [outlined]="true"
      ></p-button>
      <p-button
        label="Save Marker"
        icon="pi pi-check"
        (onClick)="lead1.saveMarker()"
        severity="success"
      ></p-button>
    </div>
  </ng-template>
</p-dialog>
}

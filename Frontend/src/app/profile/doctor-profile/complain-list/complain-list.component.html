@if (!docStore.isLoadingComp()) {
<div class="p-4 space-y-4 border border-slate-200 rounded-lg">
  <div
    class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
  >
    <p-iconfield class="w-3/5">
      <p-inputicon styleClass="pi pi-search" />
      <input
        type="text"
        pInputText
        placeholder="Search by patient name"
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)"
        (input)="filteredComplaints()"
        class="w-full"
      />
    </p-iconfield>

    <p-select
      [ngModel]="statusFilter()"
      [options]="['All', 'Pending', 'Resolved']"
      placeholder="Filter by status"
      (ngModelChange)="statusFilter.set($event)"
      class="w-full md:w-1/4"
    ></p-select>
  </div>

  @if(docStore.complaints().length > 0) {
  <p-table [value]="filteredComplaints()">
    <ng-template #header>
      <tr>
        <th>Name</th>
        <th>Complaint</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template #body let-complaint>
      <tr>
        <td>
          {{ `${complaint.patient.firstName} ${complaint.patient.lastName}`}}
        </td>
        <td>{{ complaint.issue }}</td>
        <td>
          <p-message
            [severity]="getSeverity(complaint)[0]"
            variant="outlined"
            styleClass="w-fit"
            >{{ getSeverity(complaint)[1] }}</p-message
          >
        </td>
        <td class="flex gap-2">
          <p-button
            icon="pi pi-user"
            (click)="viewPatientDetails(complaint)"
            label="View Patient"
            severity="info"
            [raised]="true"
          ></p-button>
          @if (!complaint.addressed) {
          <p-button
            icon="pi pi-pen-to-square"
            label="Address"
            severity="danger"
            [raised]="true"
            (click)="openAddressDialog(complaint)"
          ></p-button>
          }
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Dialog -->
  <p-dialog
    header="Address Complaint"
    [(visible)]="displayDialog"
    [modal]="true"
    [style]="{ width: '30rem' }"
    [closable]="true"
    [dismissableMask]="true"
  >
    <div class="text-gray-700">
      Responding to complaint from
      <strong>{{
        selectedComplaint()?.patient?.firstName +
          " " +
          selectedComplaint()?.patient?.lastName
      }}</strong
      >:
    </div>
    <p-message
      [variant]="'outlined'"
      severity="secondary"
      styleClass="mb-4 w-fit"
      size="small"
    >
      {{ selectedComplaint()?.issue }}
    </p-message>

    <textarea
      pInputTextarea
      [ngModel]="responseMessage()"
      (ngModelChange)="responseMessage.set($event)"
      rows="5"
      placeholder="Type your response..."
      class="w-full"
    ></textarea>

    <div class="mt-4 flex justify-end gap-2">
      <p-button
        type="button"
        label="Cancel"
        class="p-button-text"
        (click)="displayDialog.set(false)"
      ></p-button>

      <p-button
        type="button"
        label="Submit"
        class="p-button-primary"
        (click)="submitResponse()"
        [disabled]="!responseMessage().trim()"
      ></p-button>
    </div>
  </p-dialog>
  } @else {
  <div
    class="flex flex-col items-center justify-center p-6 bg-white border border-blue-300 rounded-lg shadow-sm w-full text-center space-y-3"
    role="alert"
  >
    <p-message
      severity="error"
      variant="outlined"
      icon="pi pi-info-circle "
      text="No complaints found"
      styleClass="text-blue-700 text-lg font-semibold"
    ></p-message>
  </div>
  }
</div>
} @else {
<div class="card">
  <div
    class="rounded border border-surface-200 dark:border-surface-700 p-6 bg-surface-0 dark:bg-surface-900"
  >
    <div class="flex mb-4">
      <p-skeleton shape="circle" size="4rem" class="mr-2" />
      <div>
        <p-skeleton width="10rem" class="mb-2" />
        <p-skeleton width="5rem" class="mb-2" />
        <p-skeleton height=".5rem" />
      </div>
    </div>
    <p-skeleton width="100%" height="150px" />
    <div class="flex justify-between mt-4">
      <p-skeleton width="4rem" height="2rem" />
      <p-skeleton width="4rem" height="2rem" />
    </div>
  </div>
</div>
}
